{"ast":null,"code":"import _typeof from \"@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _Array$isArray from \"@babel/runtime-corejs2/core-js/array/is-array\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _get from \"@babel/runtime-corejs2/helpers/esm/get\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport { useState, useEffect, useRef, useMemo } from 'react';\nimport { Hookleton } from './index';\nexport default function createPredicateHook(useHook) {\n  for (var _len = arguments.length, initialArgs = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    initialArgs[_key - 1] = arguments[_key];\n  }\n\n  return createPredicateHook.apply(void 0, [PredicateCore, useHook].concat(initialArgs));\n}\nexport function createPredicateHook(predicateClass, useHook) {\n  for (var _len2 = arguments.length, initialArgs = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n    initialArgs[_key2 - 2] = arguments[_key2];\n  }\n\n  var hook = new predicateClass(useHook, initialArgs);\n  var useFn = hook.useFn.bind(hook);\n  useFn.get = hook._get.bind(hook);\n  return useFn;\n}\nexport var Predicate =\n/*#__PURE__*/\nfunction (_PredicateCore) {\n  _inherits(Predicate, _PredicateCore);\n\n  function Predicate() {\n    _classCallCheck(this, Predicate);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Predicate).apply(this, arguments));\n  }\n\n  _createClass(Predicate, [{\n    key: \"useOnRenderFirst\",\n    value: function useOnRenderFirst(initial) {\n      return _get(_getPrototypeOf(Predicate.prototype), \"useOnRenderFirst\", this).call(this, initial).concat({\n        isFirst: true,\n        setPredicate: setPredicate\n      });\n    }\n  }, {\n    key: \"useOnRenderRest\",\n    value: function useOnRenderRest(initial) {\n      var hookOut = _get(_getPrototypeOf(Predicate.prototype), \"useOnRenderRest\", this).call(this, initial);\n\n      var len = hookOut.length;\n\n      if (len === this.hookOut.length) {\n        hookOut = hookOut.concat({\n          isFirst: false,\n          setPredicate: setPredicate\n        });\n      } else {\n        hookOut[len - i].isFirst = true;\n      }\n\n      return hookOut;\n    }\n  }]);\n\n  return Predicate;\n}(PredicateCore);\nexport var PredicateCore =\n/*#__PURE__*/\nfunction (_Hookleton) {\n  _inherits(PredicateCore, _Hookleton);\n\n  function PredicateCore() {\n    _classCallCheck(this, PredicateCore);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(PredicateCore).apply(this, arguments));\n  }\n\n  _createClass(PredicateCore, [{\n    key: \"useOnRenderRest\",\n    value: function useOnRenderRest(_ref) {\n      var _this = this;\n\n      var _ref2 = _slicedToArray(_ref, 1),\n          arg1 = _ref2[0];\n\n      var predicate;\n      var hasSet = useRef(false);\n      useMemo(function () {\n        if (_Array$isArray(arg1)) {\n          hasSet.current = true;\n          predicate = arg1[0];\n        } else {\n          predicate = arg1;\n        }\n      }, []);\n\n      var _useState = useState(),\n          _useState2 = _slicedToArray(_useState, 2),\n          updater = _useState2[1];\n\n      useEffect(function () {\n        _this._saveUpdater(updater, predicate);\n\n        return function () {\n          return _this._updaters.delete(updater);\n        }; // on unmount\n      }, []);\n      return hasSet.current ? this._hookOut.concat({\n        setPredicate: this._setPredicate(updater)\n      }) : this._hookOut;\n    }\n  }, {\n    key: \"_saveUpdater\",\n    value: function _saveUpdater(updater, predicate) {\n      this._updaters.set(updater, withPredicate(updater, predicate));\n    }\n  }, {\n    key: \"_setPredicate\",\n    value: function _setPredicate(updater) {\n      var _this2 = this;\n\n      return function (predicate) {\n        _this2._saveUpdater(updater, predicate);\n\n        _this2._updaters.get(updater)(_this2._hookOut[0]);\n      };\n    }\n  }]);\n\n  return PredicateCore;\n}(Hookleton);\n\nvar setPredicate = function setPredicate() {}; // Add 'predicate' function to updater\n\n\nfunction withPredicate(updater, p) {\n  var predicate = normalize(p);\n  return function (s) {\n    return predicate(s) && updater(forceUpdate);\n  };\n}\n\nvar forceUpdate = function forceUpdate(s) {\n  return ~s;\n};\n\nfunction normalize(p) {\n  switch (_typeof(p)) {\n    case 'undefined':\n      return TRUEFN;\n\n    case 'function':\n      return p;\n\n    case 'boolean':\n      return function () {\n        return p;\n      };\n\n    default:\n      console.warn(\"[Hookleton] predicate '\" + p + \"' is not boolean or function\");\n      return FALSEFN;\n  }\n}\n\nvar TRUEFN = function TRUEFN() {\n  return true;\n};\n\nvar FALSEFN = function FALSEFN() {\n  return false;\n};","map":{"version":3,"sources":["/Users/flx/Dropbox/Projects/hookleton/example/component/predicateHookleton.js"],"names":["useState","useEffect","useRef","useMemo","Hookleton","createPredicateHook","useHook","initialArgs","PredicateCore","predicateClass","hook","useFn","bind","get","_get","Predicate","initial","concat","isFirst","setPredicate","hookOut","len","length","i","arg1","predicate","hasSet","current","updater","_saveUpdater","_updaters","delete","_hookOut","_setPredicate","set","withPredicate","p","normalize","s","forceUpdate","TRUEFN","console","warn","FALSEFN"],"mappings":";;;;;;;;;AAAA,SAASA,QAAT,EAAmBC,SAAnB,EAA8BC,MAA9B,EAAsCC,OAAtC,QAAqD,OAArD;AACA,SAASC,SAAT,QAA0B,SAA1B;AAEA,eAAe,SAASC,mBAAT,CAA6BC,OAA7B,EAAsD;AAAA,oCAAbC,WAAa;AAAbA,IAAAA,WAAa;AAAA;;AACnE,SAAOF,mBAAmB,MAAnB,UAAoBG,aAApB,EAAmCF,OAAnC,SAA+CC,WAA/C,EAAP;AACD;AAED,OAAO,SAASF,mBAAT,CAA6BI,cAA7B,EAA6CH,OAA7C,EAAsE;AAAA,qCAAbC,WAAa;AAAbA,IAAAA,WAAa;AAAA;;AAC3E,MAAMG,IAAI,GAAG,IAAID,cAAJ,CAAmBH,OAAnB,EAA4BC,WAA5B,CAAb;AACA,MAAMI,KAAK,GAAGD,IAAI,CAACC,KAAL,CAAWC,IAAX,CAAgBF,IAAhB,CAAd;AACAC,EAAAA,KAAK,CAACE,GAAN,GAAYH,IAAI,CAACI,IAAL,CAAUF,IAAV,CAAeF,IAAf,CAAZ;AACA,SAAOC,KAAP;AACD;AAED,WAAaI,SAAb;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,qCACmBC,OADnB,EAC4B;AACxB,aAAO,gFAAuBA,OAAvB,EAAgCC,MAAhC,CAAuC;AAAEC,QAAAA,OAAO,EAAE,IAAX;AAAiBC,QAAAA,YAAY,EAAZA;AAAjB,OAAvC,CAAP;AACD;AAHH;AAAA;AAAA,oCAKkBH,OALlB,EAK2B;AACvB,UAAII,OAAO,kFAAyBJ,OAAzB,CAAX;;AACA,UAAMK,GAAG,GAAGD,OAAO,CAACE,MAApB;;AACA,UAAID,GAAG,KAAK,KAAKD,OAAL,CAAaE,MAAzB,EAAiC;AAC/BF,QAAAA,OAAO,GAAGA,OAAO,CAACH,MAAR,CAAe;AAAEC,UAAAA,OAAO,EAAE,KAAX;AAAkBC,UAAAA,YAAY,EAAZA;AAAlB,SAAf,CAAV;AACD,OAFD,MAEO;AACLC,QAAAA,OAAO,CAACC,GAAG,GAAGE,CAAP,CAAP,CAAiBL,OAAjB,GAA2B,IAA3B;AACD;;AACD,aAAOE,OAAP;AACD;AAdH;;AAAA;AAAA,EAA+BZ,aAA/B;AAiBA,WAAaA,aAAb;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,0CAC0B;AAAA;;AAAA;AAAA,UAAPgB,IAAO;;AACtB,UAAIC,SAAJ;AACA,UAAMC,MAAM,GAAGxB,MAAM,CAAC,KAAD,CAArB;AACAC,MAAAA,OAAO,CAAC,YAAM;AACZ,YAAI,eAAcqB,IAAd,CAAJ,EAAyB;AACvBE,UAAAA,MAAM,CAACC,OAAP,GAAiB,IAAjB;AACAF,UAAAA,SAAS,GAAGD,IAAI,CAAC,CAAD,CAAhB;AACD,SAHD,MAGO;AACLC,UAAAA,SAAS,GAAGD,IAAZ;AACD;AACF,OAPM,EAOJ,EAPI,CAAP;;AAHsB,sBAYFxB,QAAQ,EAZN;AAAA;AAAA,UAYb4B,OAZa;;AActB3B,MAAAA,SAAS,CAAC,YAAM;AACd,QAAA,KAAI,CAAC4B,YAAL,CAAkBD,OAAlB,EAA2BH,SAA3B;;AACA,eAAO;AAAA,iBAAM,KAAI,CAACK,SAAL,CAAeC,MAAf,CAAsBH,OAAtB,CAAN;AAAA,SAAP,CAFc,CAE+B;AAC9C,OAHQ,EAGN,EAHM,CAAT;AAKA,aAAOF,MAAM,CAACC,OAAP,GACH,KAAKK,QAAL,CAAcf,MAAd,CAAqB;AAAEE,QAAAA,YAAY,EAAE,KAAKc,aAAL,CAAmBL,OAAnB;AAAhB,OAArB,CADG,GAEH,KAAKI,QAFT;AAGD;AAvBH;AAAA;AAAA,iCAyBeJ,OAzBf,EAyBwBH,SAzBxB,EAyBmC;AAC/B,WAAKK,SAAL,CAAeI,GAAf,CAAmBN,OAAnB,EAA4BO,aAAa,CAACP,OAAD,EAAUH,SAAV,CAAzC;AACD;AA3BH;AAAA;AAAA,kCA6BgBG,OA7BhB,EA6ByB;AAAA;;AACrB,aAAO,UAAAH,SAAS,EAAI;AAClB,QAAA,MAAI,CAACI,YAAL,CAAkBD,OAAlB,EAA2BH,SAA3B;;AACA,QAAA,MAAI,CAACK,SAAL,CAAejB,GAAf,CAAmBe,OAAnB,EAA4B,MAAI,CAACI,QAAL,CAAc,CAAd,CAA5B;AACD,OAHD;AAID;AAlCH;;AAAA;AAAA,EAAmC5B,SAAnC;;AAqCA,IAAMe,YAAY,GAAG,SAAfA,YAAe,GAAM,CAAE,CAA7B,C,CAEA;;;AACA,SAASgB,aAAT,CAAuBP,OAAvB,EAAgCQ,CAAhC,EAAmC;AACjC,MAAMX,SAAS,GAAGY,SAAS,CAACD,CAAD,CAA3B;AACA,SAAO,UAAAE,CAAC;AAAA,WAAIb,SAAS,CAACa,CAAD,CAAT,IAAgBV,OAAO,CAACW,WAAD,CAA3B;AAAA,GAAR;AACD;;AAED,IAAMA,WAAW,GAAG,SAAdA,WAAc,CAAAD,CAAC;AAAA,SAAI,CAACA,CAAL;AAAA,CAArB;;AAEA,SAASD,SAAT,CAAmBD,CAAnB,EAAsB;AACpB,kBAAeA,CAAf;AACE,SAAK,WAAL;AACE,aAAOI,MAAP;;AACF,SAAK,UAAL;AACE,aAAOJ,CAAP;;AACF,SAAK,SAAL;AACE,aAAO;AAAA,eAAMA,CAAN;AAAA,OAAP;;AACF;AACEK,MAAAA,OAAO,CAACC,IAAR,CAAa,4BAA4BN,CAA5B,GAAgC,8BAA7C;AACA,aAAOO,OAAP;AATJ;AAWD;;AAED,IAAMH,MAAM,GAAG,SAATA,MAAS;AAAA,SAAM,IAAN;AAAA,CAAf;;AACA,IAAMG,OAAO,GAAG,SAAVA,OAAU;AAAA,SAAM,KAAN;AAAA,CAAhB","sourcesContent":["import { useState, useEffect, useRef, useMemo } from 'react';\nimport { Hookleton } from './index';\n\nexport default function createPredicateHook(useHook, ...initialArgs) {\n  return createPredicateHook(PredicateCore, useHook, ...initialArgs);\n}\n\nexport function createPredicateHook(predicateClass, useHook, ...initialArgs) {\n  const hook = new predicateClass(useHook, initialArgs);\n  const useFn = hook.useFn.bind(hook);\n  useFn.get = hook._get.bind(hook);\n  return useFn;\n}\n\nexport class Predicate extends PredicateCore {\n  useOnRenderFirst(initial) {\n    return super.useOnRenderFirst(initial).concat({ isFirst: true, setPredicate });\n  }\n\n  useOnRenderRest(initial) {\n    let hookOut = super.useOnRenderRest(initial);\n    const len = hookOut.length;\n    if (len === this.hookOut.length) {\n      hookOut = hookOut.concat({ isFirst: false, setPredicate });\n    } else {\n      hookOut[len - i].isFirst = true;\n    }\n    return hookOut;\n  }\n}\n\nexport class PredicateCore extends Hookleton {\n  useOnRenderRest([arg1]) {\n    let predicate;\n    const hasSet = useRef(false);\n    useMemo(() => {\n      if (Array.isArray(arg1)) {\n        hasSet.current = true;\n        predicate = arg1[0];\n      } else {\n        predicate = arg1;\n      }\n    }, []);\n\n    const [, updater] = useState();\n\n    useEffect(() => {\n      this._saveUpdater(updater, predicate);\n      return () => this._updaters.delete(updater); // on unmount\n    }, []);\n\n    return hasSet.current\n      ? this._hookOut.concat({ setPredicate: this._setPredicate(updater) })\n      : this._hookOut;\n  }\n\n  _saveUpdater(updater, predicate) {\n    this._updaters.set(updater, withPredicate(updater, predicate));\n  }\n\n  _setPredicate(updater) {\n    return predicate => {\n      this._saveUpdater(updater, predicate);\n      this._updaters.get(updater)(this._hookOut[0]);\n    };\n  }\n}\n\nconst setPredicate = () => {};\n\n// Add 'predicate' function to updater\nfunction withPredicate(updater, p) {\n  const predicate = normalize(p);\n  return s => predicate(s) && updater(forceUpdate);\n}\n\nconst forceUpdate = s => ~s;\n\nfunction normalize(p) {\n  switch (typeof p) {\n    case 'undefined':\n      return TRUEFN;\n    case 'function':\n      return p;\n    case 'boolean':\n      return () => p;\n    default:\n      console.warn(\"[Hookleton] predicate '\" + p + \"' is not boolean or function\");\n      return FALSEFN;\n  }\n}\n\nconst TRUEFN = () => true;\nconst FALSEFN = () => false;\n"]},"metadata":{},"sourceType":"module"}