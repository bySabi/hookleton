{"ast":null,"code":"import _typeof from \"@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _Array$isArray from \"@babel/runtime-corejs2/core-js/array/is-array\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport { useState, useEffect, useRef, useMemo } from 'react';\nimport { Hookleton } from './index';\nexport default function createPredicateHook(useHook) {\n  for (var _len = arguments.length, initialArgs = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    initialArgs[_key - 1] = arguments[_key];\n  }\n\n  var hook = new Predicate(useHook, initialArgs);\n  var useFn = hook.useFn.bind(hook);\n  useFn.get = hook._get.bind(hook);\n  return useFn;\n}\n\nvar Predicate =\n/*#__PURE__*/\nfunction (_Hookleton) {\n  _inherits(Predicate, _Hookleton);\n\n  function Predicate(useHook, initialArgs) {\n    _classCallCheck(this, Predicate);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Predicate).call(this, useHook, initialArgs));\n  }\n\n  _createClass(Predicate, [{\n    key: \"useOnSlaveRender\",\n    value: function useOnSlaveRender(_ref) {\n      var _this = this;\n\n      var _ref2 = _slicedToArray(_ref, 1),\n          arg1 = _ref2[0];\n\n      var predicate;\n      var hasSet = useRef(false);\n      useMemo(function () {\n        if (_Array$isArray(arg1)) {\n          hasSet.current = true;\n          predicate = arg1[0];\n        } else {\n          predicate = arg1;\n        }\n      }, []);\n\n      var _useState = useState(),\n          _useState2 = _slicedToArray(_useState, 2),\n          updater = _useState2[1];\n\n      useEffect(function () {\n        _this._saveUpdater(updater, predicate);\n\n        return function () {\n          return _this._updaters.delete(updater);\n        }; // on unmount\n      }, []);\n      return hasSet.current ? this.hookOut.concat({\n        setPredicate: this._setPredicate(updater)\n      }) : this.hookOut;\n    }\n  }, {\n    key: \"_saveUpdater\",\n    value: function _saveUpdater(updater, predicate) {\n      this.slaves.set(updater, withPredicate(updater, predicate));\n    }\n  }, {\n    key: \"_setPredicate\",\n    value: function _setPredicate(updater) {\n      var _this2 = this;\n\n      return function (predicate) {\n        _this2._saveUpdater(updater, predicate);\n\n        _this2.slaves.get(updater)(_this2.hookOut[0]);\n      };\n    }\n  }]);\n\n  return Predicate;\n}(Hookleton); // Add 'predicate' function to slave updater\n\n\nfunction withPredicate(updater, p) {\n  var predicate = normalize(p);\n  return function (s) {\n    return predicate(s) && updater(forceUpdate);\n  };\n}\n\nvar forceUpdate = function forceUpdate(s) {\n  return ~s;\n};\n\nfunction normalize(p) {\n  switch (_typeof(p)) {\n    case 'undefined':\n      return TRUEFN;\n\n    case 'function':\n      return p;\n\n    case 'boolean':\n      return function () {\n        return p;\n      };\n\n    default:\n      console.warn(\"[Hookleton] predicate '\" + p + \"' is not boolean or function\");\n      return FALSEFN;\n  }\n}\n\nvar TRUEFN = function TRUEFN() {\n  return true;\n};\n\nvar FALSEFN = function FALSEFN() {\n  return false;\n};","map":{"version":3,"sources":["/Users/flx/Dropbox/Projects/hookleton/example/component/predicateHookleton.js"],"names":["useState","useEffect","useRef","useMemo","Hookleton","createPredicateHook","useHook","initialArgs","hook","Predicate","useFn","bind","get","_get","arg1","predicate","hasSet","current","updater","_saveUpdater","_updaters","delete","hookOut","concat","setPredicate","_setPredicate","slaves","set","withPredicate","p","normalize","s","forceUpdate","TRUEFN","console","warn","FALSEFN"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef, useMemo } from 'react';\nimport { Hookleton } from './index';\n\nexport default function createPredicateHook(useHook, ...initialArgs) {\n  const hook = new Predicate(useHook, initialArgs);\n  const useFn = hook.useFn.bind(hook);\n  useFn.get = hook._get.bind(hook);\n  return useFn;\n}\n\nclass Predicate extends Hookleton {\n  constructor(useHook, initialArgs) {\n    super(useHook, initialArgs);\n  }\n\n  useOnSlaveRender([arg1]) {\n    let predicate;\n    const hasSet = useRef(false);\n    useMemo(() => {\n      if (Array.isArray(arg1)) {\n        hasSet.current = true;\n        predicate = arg1[0];\n      } else {\n        predicate = arg1;\n      }\n    }, []);\n\n    const [, updater] = useState();\n\n    useEffect(() => {\n      this._saveUpdater(updater, predicate);\n      return () => this._updaters.delete(updater); // on unmount\n    }, []);\n\n    return hasSet.current\n      ? this.hookOut.concat({ setPredicate: this._setPredicate(updater) })\n      : this.hookOut;\n  }\n\n  _saveUpdater(updater, predicate) {\n    this.slaves.set(updater, withPredicate(updater, predicate));\n  }\n\n  _setPredicate(updater) {\n    return predicate => {\n      this._saveUpdater(updater, predicate);\n      this.slaves.get(updater)(this.hookOut[0]);\n    };\n  }\n}\n\n// Add 'predicate' function to slave updater\nfunction withPredicate(updater, p) {\n  const predicate = normalize(p);\n  return s => predicate(s) && updater(forceUpdate);\n}\n\nconst forceUpdate = s => ~s;\n\nfunction normalize(p) {\n  switch (typeof p) {\n    case 'undefined':\n      return TRUEFN;\n    case 'function':\n      return p;\n    case 'boolean':\n      return () => p;\n    default:\n      console.warn(\"[Hookleton] predicate '\" + p + \"' is not boolean or function\");\n      return FALSEFN;\n  }\n}\n\nconst TRUEFN = () => true;\nconst FALSEFN = () => false;\n"]},"metadata":{},"sourceType":"module"}