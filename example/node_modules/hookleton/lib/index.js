"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var react=require("react");function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _iterableToArrayLimit(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function createHook(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return createHookWithClass.apply(void 0,[Hookleton,t].concat(r))}function createHookWithClass(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];var a=new t(e,n),i=a.useFn.bind(a);return i.get=a._get.bind(a),i}var Hookleton=function(){function t(e,r){_classCallCheck(this,t),this._useHook=e,this._args=r,this._hookOut=[],this._updaters=new Map}return _createClass(t,[{key:"useFn",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=react.useRef(!1);return react.useMemo(function(){return t._onInit({isFirst:o,initialArgs:r})},[]),o.current?(this._hookOut=this._useHook.apply(this,_toConsumableArray(this._args)),react.useMemo(function(){if(!Array.isArray(t._hookOut))throw new Error("[Hookleton] provided 'useHook' must return array values")},[]),this.useOnFirst(this._args)):this.useOnRest(r)}},{key:"useOnFirst",value:function(){return react.useEffect(this.__updateRest.bind(this),[this._hookOut[0]]),this._hookOut}},{key:"useOnRest",value:function(){var t=this,e=_slicedToArray(react.useState(),2)[1];return react.useEffect(function(){return t._updaters.set(e,wrapUpdater(e)),function(){return t._updaters.delete(e)}},[]),this._hookOut}},{key:"_onInit",value:function(t){var e=t.isFirst,r=t.initialArgs;this._onInit=function(){},e.current=!0,this._args=this._args.length>0?this._args:r}},{key:"_updateRest",value:function(){var t=this;this._updaters.forEach(function(e){return e(t._hookOut[0])})}},{key:"__updateRest",value:function(){this.__updateRest=this._updateRest}},{key:"_get",value:function(){return this._hookOut}}]),t}(),wrapUpdater=function(t){return function(){return t(forceUpdate)}},forceUpdate=function(t){return~t};exports.default=createHook,exports.createHookWithClass=createHookWithClass,exports.Hookleton=Hookleton;
