{"ast":null,"code":"import _typeof from \"@babel/runtime-corejs2/helpers/esm/typeof\";\nimport _Array$isArray from \"@babel/runtime-corejs2/core-js/array/is-array\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _get from \"@babel/runtime-corejs2/helpers/esm/get\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport { useState, useEffect, useRef, useMemo } from 'react';\nimport { Hookleton } from './index';\nexport default function createPredicateHook(useHook) {\n  for (var _len = arguments.length, initialArgs = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    initialArgs[_key - 1] = arguments[_key];\n  }\n\n  var hook = new Predicate(useHook, initialArgs);\n  var useFn = hook.useFn.bind(hook);\n  useFn.get = hook._get.bind(hook);\n  return useFn;\n}\n\nvar Predicate2 =\n/*#__PURE__*/\nfunction (_Predicate) {\n  _inherits(Predicate2, _Predicate);\n\n  function Predicate2() {\n    _classCallCheck(this, Predicate2);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Predicate2).apply(this, arguments));\n  }\n\n  _createClass(Predicate2, [{\n    key: \"useOnRenderFirst\",\n    value: function useOnRenderFirst(initial) {\n      return _get(_getPrototypeOf(Predicate2.prototype), \"useOnRenderFirst\", this).call(this, initial).concat({\n        isFirst: true\n      });\n    }\n  }, {\n    key: \"useOnRenderRest\",\n    value: function useOnRenderRest(initial) {\n      var hookOut = _get(_getPrototypeOf(Predicate2.prototype), \"useOnRenderRest\", this).call(this, initial);\n\n      return hookOut;\n    }\n  }]);\n\n  return Predicate2;\n}(Predicate);\n\nvar Predicate =\n/*#__PURE__*/\nfunction (_Hookleton) {\n  _inherits(Predicate, _Hookleton);\n\n  function Predicate() {\n    _classCallCheck(this, Predicate);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Predicate).apply(this, arguments));\n  }\n\n  _createClass(Predicate, [{\n    key: \"useOnRenderRest\",\n    value: function useOnRenderRest(_ref) {\n      var _this = this;\n\n      var _ref2 = _slicedToArray(_ref, 1),\n          arg1 = _ref2[0];\n\n      var predicate;\n      var hasSet = useRef(false);\n      useMemo(function () {\n        if (_Array$isArray(arg1)) {\n          hasSet.current = true;\n          predicate = arg1[0];\n        } else {\n          predicate = arg1;\n        }\n      }, []);\n\n      var _useState = useState(),\n          _useState2 = _slicedToArray(_useState, 2),\n          updater = _useState2[1];\n\n      useEffect(function () {\n        _this._saveUpdater(updater, predicate);\n\n        return function () {\n          return _this._updaters.delete(updater);\n        }; // on unmount\n      }, []);\n      return hasSet.current ? this.hookOut.concat({\n        setPredicate: this._setPredicate(updater)\n      }) : this.hookOut;\n    }\n  }, {\n    key: \"_saveUpdater\",\n    value: function _saveUpdater(updater, predicate) {\n      this._updaters.set(updater, withPredicate(updater, predicate));\n    }\n  }, {\n    key: \"_setPredicate\",\n    value: function _setPredicate(updater) {\n      var _this2 = this;\n\n      return function (predicate) {\n        _this2._saveUpdater(updater, predicate);\n\n        _this2._updaters.get(updater)(_this2.hookOut[0]);\n      };\n    }\n  }]);\n\n  return Predicate;\n}(Hookleton); // Add 'predicate' function to updater\n\n\nfunction withPredicate(updater, p) {\n  var predicate = normalize(p);\n  return function (s) {\n    return predicate(s) && updater(forceUpdate);\n  };\n}\n\nvar forceUpdate = function forceUpdate(s) {\n  return ~s;\n};\n\nfunction normalize(p) {\n  switch (_typeof(p)) {\n    case 'undefined':\n      return TRUEFN;\n\n    case 'function':\n      return p;\n\n    case 'boolean':\n      return function () {\n        return p;\n      };\n\n    default:\n      console.warn(\"[Hookleton] predicate '\" + p + \"' is not boolean or function\");\n      return FALSEFN;\n  }\n}\n\nvar TRUEFN = function TRUEFN() {\n  return true;\n};\n\nvar FALSEFN = function FALSEFN() {\n  return false;\n};","map":{"version":3,"sources":["/Users/flx/Dropbox/Projects/hookleton/example/component/predicateHookleton.js"],"names":["useState","useEffect","useRef","useMemo","Hookleton","createPredicateHook","useHook","initialArgs","hook","Predicate","useFn","bind","get","_get","Predicate2","initial","concat","isFirst","hookOut","arg1","predicate","hasSet","current","updater","_saveUpdater","_updaters","delete","setPredicate","_setPredicate","set","withPredicate","p","normalize","s","forceUpdate","TRUEFN","console","warn","FALSEFN"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef, useMemo } from 'react';\nimport { Hookleton } from './index';\n\nexport default function createPredicateHook(useHook, ...initialArgs) {\n  const hook = new Predicate(useHook, initialArgs);\n  const useFn = hook.useFn.bind(hook);\n  useFn.get = hook._get.bind(hook);\n  return useFn;\n}\n\n\nclass Predicate2 extends Predicate {\n  useOnRenderFirst(initial) {\n\n    return super.useOnRenderFirst(initial).concat({ isFirst: true });\n  }\n\n  useOnRenderRest(initial) {\n    const hookOut = super.useOnRenderRest(initial)\n    return hookOut;\n  }\n}\n\n\nclass Predicate extends Hookleton {\n  useOnRenderRest([arg1]) {\n    let predicate;\n    const hasSet = useRef(false);\n    useMemo(() => {\n      if (Array.isArray(arg1)) {\n        hasSet.current = true;\n        predicate = arg1[0];\n      } else {\n        predicate = arg1;\n      }\n    }, []);\n\n    const [, updater] = useState();\n\n    useEffect(() => {\n      this._saveUpdater(updater, predicate);\n      return () => this._updaters.delete(updater); // on unmount\n    }, []);\n\n    return hasSet.current\n      ? this.hookOut.concat({ setPredicate: this._setPredicate(updater) })\n      : this.hookOut;\n  }\n\n  _saveUpdater(updater, predicate) {\n    this._updaters.set(updater, withPredicate(updater, predicate));\n  }\n\n  _setPredicate(updater) {\n    return predicate => {\n      this._saveUpdater(updater, predicate);\n      this._updaters.get(updater)(this.hookOut[0]);\n    };\n  }\n}\n\n// Add 'predicate' function to updater\nfunction withPredicate(updater, p) {\n  const predicate = normalize(p);\n  return s => predicate(s) && updater(forceUpdate);\n}\n\nconst forceUpdate = s => ~s;\n\nfunction normalize(p) {\n  switch (typeof p) {\n    case 'undefined':\n      return TRUEFN;\n    case 'function':\n      return p;\n    case 'boolean':\n      return () => p;\n    default:\n      console.warn(\"[Hookleton] predicate '\" + p + \"' is not boolean or function\");\n      return FALSEFN;\n  }\n}\n\nconst TRUEFN = () => true;\nconst FALSEFN = () => false;\n"]},"metadata":{},"sourceType":"module"}